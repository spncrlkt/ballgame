# Test: Steal knockback on success
# Verifies that successful steals apply knockback to the victim
# Note: Steal success is RNG (33% base), so this test runs multiple frames
# to allow time for a successful steal, then checks for position change
#
# FAIL conditions this test catches:
# - Knockback not applied on successful steal
# - Knockback direction incorrect
# - Knockback strength too low to measure
#
# Limitation: Due to RNG, this test may pass even if knockback is broken
# (if steal never succeeds). Consider adding seeded RNG for deterministic testing.

name = "Steal knockback"
description = "Successful steal pushes the victim away"

[setup]
level = "test_steal_arena"

# Stealer on the right, holder on the left
# Knockback should push holder further left (negative X direction)
# Floor at y=-450, floor top at -430, player center at -398
[[setup.entities]]
type = "player"
id = "holder"
team = "left"
x = 0.0
y = -398.0
holding_ball = true

[[setup.entities]]
type = "player"
id = "stealer"
team = "right"
x = 50.0
y = -398.0

# Stealer attempts steal - may succeed (~33% chance)
[[input]]
frame = 10
stealer = { pickup = true }

# Second attempt after cooldown (0.3s = ~18 frames)
[[input]]
frame = 30
stealer = { pickup = true }

# Third attempt
[[input]]
frame = 50
stealer = { pickup = true }

# Fourth attempt
[[input]]
frame = 70
stealer = { pickup = true }

# Should see at least one steal attempt
[[expect.sequence]]
event = "StealAttempt"
player = "stealer"
frame_min = 5
frame_max = 80

# State check at end - if steal succeeded, holder should have moved left
# If all steals failed, holder stays at x=0
# Either outcome is valid for this test (verifies no crash/error)
[[expect.state]]
after_frame = 90
checks = [
    "holder.x < 100",        # Holder didn't go through right wall
    "stealer.x > -100",      # Stealer didn't go through left wall
]
