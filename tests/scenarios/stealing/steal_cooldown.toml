# Test: Steal cooldown
# Verifies player cannot steal again immediately after an attempt
#
# FAIL conditions this test catches:
# - Cooldown not triggering: multiple steals happen in quick succession
# - Cooldown too short: second attempt goes through

name = "Steal cooldown"
description = "Only one steal attempt fires despite multiple pickup inputs"

[setup]
level = "test_steal_arena"

# Two players close together - both in steal range
# Floor at y=-450, floor top at -430, player center at -398
[[setup.entities]]
type = "player"
id = "holder"
team = "left"
x = 0.0
y = -398.0
holding_ball = true

[[setup.entities]]
type = "player"
id = "stealer"
team = "right"
x = 40.0
y = -398.0

# First steal attempt (in range, triggers cooldown)
[[input]]
frame = 10
stealer = { pickup = true }

# Second steal attempt quickly (should be blocked by cooldown)
[[input]]
frame = 15
stealer = { pickup = true }

# Third attempt (still on cooldown at 0.3s = ~18 frames)
[[input]]
frame = 20
stealer = { pickup = true }

# Only one StealAttempt should fire - the cooldown blocks subsequent attempts
[[expect.sequence]]
event = "StealAttempt"
player = "stealer"
frame_min = 5
frame_max = 15

# State check at frame 25 - holder should still have ball if steal failed
# (most likely outcome) or stealer picked it up (less likely)
# Either way, the game state should be consistent
[[expect.state]]
after_frame = 25
checks = [
    "holder.x > -50",
    "stealer.x > 0",
]
