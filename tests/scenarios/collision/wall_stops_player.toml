# Test: Wall collision
# Verifies player cannot walk through walls
#
# FAIL conditions this test catches:
# - Wall collision not working: player passes through wall
# - Collision detection broken: player stops too early or clips through

name = "Wall stops player"
description = "Player is stopped by arena wall when walking into it"

[setup]
level = "test_flat_floor"

# Floor at y=-450, floor top at -430, player center at -398
# Arena width is 1600, wall inner edge at x=-780
# Player half-width is 16 (PLAYER_SIZE.x = 32)
# So player center min x = -780 + 16 = -764
[[setup.entities]]
type = "player"
id = "p1"
team = "left"
x = -600.0
y = -398.0

# Move left continuously
[[input]]
frame = 0
p1 = { move_left = true }

[[input]]
frame = 120
p1 = { move_left = false }

# Check at frame 60 - should be moving but not at wall yet
[[expect.state]]
after_frame = 60
checks = [
    "p1.x < -650",            # Should have moved left significantly
    "p1.velocity_x < -50",    # Should still be moving left
]

# Check at frame 120 - should be at wall
[[expect.state]]
after_frame = 120
checks = [
    "p1.x > -770",            # Should be stopped by wall (with ~6 unit tolerance)
    "p1.x < -760",            # Should be close to wall (tighter than before)
]
