# Test: Jump reaches maximum height
# Verifies player can jump high enough to reach expected peak (~215 units)
#
# FAIL conditions this test catches:
# - Jump velocity too low: doesn't reach expected height
# - Gravity too strong: peak height lower than expected
# - Jump cut applied incorrectly: height reduced when it shouldn't be

name = "Jump reaches max height"
description = "Full jump (button held) reaches ~215 units above ground"

[setup]
level = "test_flat_floor"

# Floor at y=-450, floor top at -430, player lands with center at -398
# Spawn at landing position to ensure immediate jump
[[setup.entities]]
type = "player"
id = "p1"
team = "left"
x = 0.0
y = -398.0

# Hold jump for full height (need to keep held for multiple frames)
[[input]]
frame = 5
p1 = { jump = true }

[[input]]
frame = 10
p1 = { jump = true }

[[input]]
frame = 15
p1 = { jump = true }

[[input]]
frame = 20
p1 = { jump = true }

[[input]]
frame = 25
p1 = { jump = true }

# Check at frame 15 - should be rising
[[expect.state]]
after_frame = 15
checks = [
    "p1.grounded = false",
    "p1.velocity_y > 0",      # Still rising
]

# Check at peak (~frame 35-45) - should be near max height
# Jump velocity = 650, gravity_rise = 980
# Time to peak: t = v/g = 650/980 ≈ 0.66s = 40 frames after jump
# Max height: h = v²/(2g) = 650²/(2*980) ≈ 215 units
# Starting at y=-398, so peak at ~-398 + 215 = -183
[[expect.state]]
after_frame = 45
checks = [
    "p1.y > -220",            # Should be near peak height
]

# Check at frame 55 - should be descending
[[expect.state]]
after_frame = 55
checks = [
    "p1.velocity_y < 0",      # Should be falling now
]
